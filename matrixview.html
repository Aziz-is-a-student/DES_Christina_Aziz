<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DES - Bit Matrix View</title>
  <style>
    .bit-label {
      opacity: 0;
      animation: fadeIn 0.5s ease-in forwards;
      animation-delay: var(--delay, 0ms);
    }

    body {
      font-family: monospace;
      background-color: #fff;
      color: #000;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      zoom: 1.3
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    h2 {
      margin-top: 5px;
      text-align: center;
    }

    table {
      border-collapse: separate;
      border-spacing: 3.5px;
      border-radius: 12px;
      overflow: hidden;
      background-color: white;
      border: none;
    }

    td {
      width: 30px;
      height: 30px;
      text-align: center;
      vertical-align: middle;
      font-size: 18px;
      border-radius: 6px;
    }

    .nav {
      margin-top: 30px;
    }

    .bit-box {
      fill: #f0f0f0;
      stroke: #ccc;
      opacity: 0;
      animation: fadeIn 0.5s ease-in forwards;
      rx: 6;
      ry: 6;
    }

    svg {
      border-radius: 1px;
      background-color: #fff;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .description-block {
      display: flex;
      align-items: center;
      gap: 40px;
      margin-top: 20px;
      justify-content: center;
      flex-wrap: wrap;
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: 12px;
      background-color: white;
    }

    .description-box {
      padding: 20px;
      background-color: #fdfdfd;
      border-radius: 12px;
      max-width: 400px;
      text-align: center;
    }

    .description-box h3 {
      margin-top: 0;
      margin-bottom: 16px;
    }

    .nav-button {
      padding: 8px 20px;
      font-size: 14px;
      background-color: #1e88e5;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: white;
      transition: background-color 0.3s ease;
    }

    .nav-button:hover {
      filter: brightness(0.9);
    }

    .fade-soft {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 1s ease, transform 1s ease;
    }
    .fade-soft.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>

<body>
  <div class="centered fade-soft" id="titleHeader" style="text-align: center; ">
    <h1>DES Encryption Process</h1>
  </div>
  <h2 class="fade-soft" id="bitMatrixSub" style="color: #fb8c00; margin-top: -5px;">Bit Matrix View ðŸ§±</h2>



  <h2 class="fade-soft" id="keyMessageGroup">
    <span style="color: #1e88e5;">Key:</span> <span id="keyView" class="green" style="color: green;"></span>
    &nbsp;&nbsp;
    <span style="color: #1e88e5;">Message:</span> <span id="messageView" class="green" style="color: green;"></span>
  </h2>

  <div class="description-block fade-soft" id="descBlock" style="margin-top: 10px;">
    <div class="description-box">
      <h3 style="margin-bottom: 20px;">Matrix structure of a single block</h3>
      <p style="margin: 0;">
        This is how <strong>Blocks</strong> are represented as an 8Ã—8 matrix of bits.<br>
        Each block is filled row by row, from top to bottom and left to right â€” each bit represents one position in the
        original byte stream.<br><br>
        A full 8Ã—8 matrix consists of 64 positions in total, indexed from 1 to 64. These indices correspond to the order
        of bits from the input stream,<br>
        helping visualize the structure DES operates on. This matrix layout helps emphasize how bitwise operations are
        applied within DES cycles.
      </p>
    </div>
    <div>
      <svg id="demoMatrix" width="240" height="240">
        <style>
          .bit-label {
            font-size: 10px;
            fill: #000;
            text-anchor: middle;
          }

          .bit-box {
            fill: #f0f0f0;
            stroke: #ccc;
            rx: 6;
            ry: 6;
          }
        </style>
      </svg>
    </div>
  </div>

  <div id="navButtons" class="fade-soft"
    style="margin-top: 20px; display: flex; gap: 20px; justify-content: center; margin-bottom: 10px;">
    <a href="inputbreakdown.html" style="text-decoration: none;">
      <button class="nav-button">Back</button>
    </a>

    <a href="ippermutation.html" style="text-decoration: none;">
      <button class="nav-button">Next</button>
    </a>
  </div>

  <div id="matrixContainer" style="display: flex; flex-wrap: wrap; gap: 40px; justify-content: center;"></div>

  <script>
    const allBlocks = JSON.parse(localStorage.getItem("allBlocks")) || [];
    const container = document.getElementById("matrixContainer");
    container.innerHTML = '';

    const keyBlock = JSON.parse(localStorage.getItem("keyBlock")) || [];
    if (keyBlock.length === 8) {
      const keyLabel = document.createElement("h3");
      keyLabel.innerHTML = "<span style='color: #ec407a; font-weight: bold;'>Key Block</span>";
      keyLabel.style.position = 'relative';
      keyLabel.style.top      = '9px';
      const keyWrapper = document.createElement("div");
      keyWrapper.style.display = "inline-block";
      keyWrapper.style.marginTop = "0px";
      keyWrapper.style.paddingTop = "0px";
      keyWrapper.style.transform = "translateY(-10px)";
      keyWrapper.style.verticalAlign = "top";
      keyWrapper.style.margin = "10px";
      keyWrapper.style.borderRadius = "10px";
      keyWrapper.style.textAlign = "center";
      keyWrapper.style.opacity = '0';
      keyWrapper.style.animation = `fadeIn 0.3s ease-in forwards`;
      keyWrapper.style.animationDelay = `2500ms`;
      keyWrapper.appendChild(keyLabel);

      const table = document.createElement("table");
      const tbody = document.createElement("tbody");

      for (let i = 0; i < 8; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 8; j++) {
          const bit = keyBlock[i][j];
          const cell = document.createElement("td");
          cell.textContent = bit;
          cell.style.backgroundColor = '#fce4ec';
          cell.style.border = '1.5px solid #ec407a';
          cell.style.opacity = '0';
          cell.style.animation = `fadeIn 0.3s ease-in forwards`;
          cell.style.animationDelay = `${2800 + (i * 8 + j) * 60}ms`;
          row.appendChild(cell);
        }
        tbody.appendChild(row);
      }

      table.appendChild(tbody);
      keyWrapper.appendChild(table);
      container.prepend(keyWrapper);
    }

const keyCellBase = 500;
const keyCellStagger = 60;
const keyCellsCount = 8 * 8; 
const keyTotalDelay = keyCellBase + (keyCellsCount - 1) * keyCellStagger;

var blockStartDelay = keyTotalDelay + 500;  


    allBlocks.forEach((block, index) => {
      const blockDelay = blockStartDelay + index * 1300;
      const label = document.createElement("h3");
      label.innerHTML = `<span style='color: #1e88e5'>Block #${index + 1}</span>`;
      label.style.position = 'relative';
      label.style.top      = '9px';
      const blockWrapper = document.createElement("div");
      blockWrapper.style.display = "inline-block";
      blockWrapper.style.verticalAlign = "top";
      blockWrapper.style.opacity = '0';
      blockWrapper.style.textAlign = "center";
      blockWrapper.style.animation = `fadeIn 0.3s ease-in forwards`;
      blockWrapper.style.animationDelay = `${blockDelay}ms`;
      blockWrapper.appendChild(label);

      const table = document.createElement("table");
      const tbody = document.createElement("tbody");

      for (let rowIndex = 0; rowIndex < 8; rowIndex++) {
        const row = document.createElement("tr");
        for (let colIndex = 0; colIndex < 8; colIndex++) {
          const bit = block[rowIndex]?.[colIndex] ?? "0";
          const cell = document.createElement("td");
          cell.textContent = bit;
          cell.style.backgroundColor = '#e3f2fd';
          cell.style.border = '1.5px solid #64b5f6';
          cell.style.opacity = '0';
          cell.style.animation = `fadeIn 0.3s ease-in forwards`;
          cell.style.animationDelay = `${blockDelay + 200 + (rowIndex * 8 + colIndex) * 30}ms`;
          row.appendChild(cell);
        }
        tbody.appendChild(row);
      }

      table.appendChild(tbody);
      blockWrapper.appendChild(table);
      container.appendChild(blockWrapper);
    });

    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.getElementById("demoMatrix");
    let i = 1;
    for (let row = 0; row < 8; row++) {
      for (let col = 0; col < 8; col++) {
        const x = 10 + col * 28;
        const y = 10 + row * 28;

        const rect = document.createElementNS(svgNS, 'rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', y);
        rect.setAttribute('width', 25);
        rect.setAttribute('height', 25);
        rect.setAttribute('rx', 6);
        rect.setAttribute('ry', 6);
        rect.setAttribute('class', 'bit-box');
        rect.style.setProperty('--delay', `${(row * 8 + col) * 20}ms`);
        svg.appendChild(rect);

        const label = document.createElementNS(svgNS, 'text');
        label.setAttribute('x', x + 12.5);
        label.setAttribute('y', y + 16);
        label.setAttribute('class', 'bit-label');
        label.style.setProperty('--delay', `${(row * 8 + col) * 20}ms`);
        label.textContent = i++;
        svg.appendChild(label);
      }
    }

    document.getElementById("messageView").innerText = localStorage.getItem("des_message_original") || "";
    document.getElementById("keyView").innerText = localStorage.getItem("des_key_original") || "";

    window.addEventListener("DOMContentLoaded", async () => {
      const title = document.getElementById("titleHeader");
      const sub = document.getElementById("bitMatrixSub");
      const keyMsg = document.getElementById("keyMessageGroup");
      const desc = document.getElementById("descBlock");
      const navButtons = document.getElementById("navButtons");

      const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

      title.classList.add("fade-soft");
      sub.classList.add("fade-soft");
      keyMsg.classList.add("fade-soft");
      desc.classList.add("fade-soft");
      navButtons.classList.add("fade-soft");

      await delay(100);
      title.classList.add("show");
      await delay(100);
      sub.classList.add("show");
      await delay(100);
      keyMsg.classList.add("show");
      await delay(100);
      desc.classList.add("show");
      await delay(100);
      navButtons.classList.add("show");
    });

  </script>
</body>

</html>